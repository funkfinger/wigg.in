I"r<p>This may not be the best way to do this, but this is what I used at the top of my test file so that a helper method has a value for Rack’s env[‘HTTP_HOST’]:</p>

<pre lang="ruby" line="1">
class FundastacheUserTest &lt; Test::Unit::TestCase
  ...
  def env
    last_request.env['HTTP_HOST']="example.org"
    last_request.env
  end
  ...
</pre>

<p>The test tests to see that using the activation link (that a user gets in an email) activates the user. It looks something like this:</p>

<pre lang="ruby" line="1">
  def test_using_activation_link_should_activate_account
    create_user
    user=User.first
    path=activation_link(user)
    path=~/http\:\/\/example.org(.*)/
    get $1
    follow_redirect!
    assert last_response.ok?
    assert last_response.body.include?('Account activated!')
    user=User.first
    assert user.activated
  end
</pre>

<p>and the helper method looks something like this:</p>

<pre lang="ruby" line="1">

module FundAStache
  module Helpers    
    ...
    def activation_link(user)
      "http://#{env['HTTP_HOST']}/user/activate/#{user.activation_token}"
    end
    ...
  end
end
</pre>
:ET